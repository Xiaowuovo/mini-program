<!--pages/gardens/gardens.wxml-->
<view class="container gardens-page">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input">
      <text class="search-icon">ğŸ”</text>
      <input
        type="text"
        placeholder="æœç´¢èœåœ°åç§°æˆ–ä½ç½®"
        value="{{keyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearch"
      />
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view
      class="filter-item {{currentStatus === '' ? 'active' : ''}}"
      bindtap="onFilterStatus"
      data-status=""
    >
      å…¨éƒ¨
    </view>
    <view
      class="filter-item {{currentStatus === 'available' ? 'active' : ''}}"
      bindtap="onFilterStatus"
      data-status="available"
    >
      å¯ç§Ÿç”¨
    </view>
    <view
      class="filter-item {{currentStatus === 'rented' ? 'active' : ''}}"
      bindtap="onFilterStatus"
      data-status="rented"
    >
      å·²ç§Ÿå‡º
    </view>
    <view
      class="filter-item {{currentStatus === 'maintenance' ? 'active' : ''}}"
      bindtap="onFilterStatus"
      data-status="maintenance"
    >
      ç»´æŠ¤ä¸­
    </view>
  </view>

  <!-- æ’åºæ  -->
  <view class="sort-bar">
    <view class="sort-item" bindtap="onSort" data-field="price">
      ä»·æ ¼ <text class="sort-icon">{{sortField === 'price' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : ''}}</text>
    </view>
    <view class="sort-item" bindtap="onSort" data-field="area">
      é¢ç§¯ <text class="sort-icon">{{sortField === 'area' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : ''}}</text>
    </view>
  </view>

  <!-- èœåœ°åˆ—è¡¨ -->
  <view class="garden-list">
    <view
      wx:for="{{gardens}}"
      wx:key="id"
      class="garden-item"
      bindtap="navigateToDetail"
      data-id="{{item.id}}"
    >
      <image
        src="{{item.image_url || (item.images && item.images.length > 0 ? item.images[0] : '/images/default-garden.png')}}"
        class="garden-image"
        mode="aspectFill"
        binderror="onImageError"
        data-index="{{index}}"
      ></image>

      <view class="garden-info">
        <view class="garden-header">
          <text class="garden-name">{{item.name}}</text>
          <view wx:if="{{item.is_mine}}" class="my-garden-badge">æˆ‘çš„èœåœ°</view>
          <view class="garden-status status-{{item.status}}">
            {{item.status === 'available' ? 'å¯ç§Ÿç”¨' : item.status === 'rented' ? 'å·²ç§Ÿå‡º' : 'ç»´æŠ¤ä¸­'}}
          </view>
        </view>

        <view class="garden-desc">
          <view class="desc-item">
            <text class="desc-icon">ğŸ“</text>
            <text>{{item.area}}ã¡</text>
          </view>
          <view class="desc-item">
            <text class="desc-icon">ğŸ“</text>
            <text>{{item.location || 'æš‚æ— ä½ç½®ä¿¡æ¯'}}</text>
          </view>
        </view>

        <view class="garden-footer">
          <view class="garden-price">
            <text class="price-number">Â¥{{item.price}}</text>
            <text class="price-unit">/æœˆ</text>
          </view>
          <view class="garden-action">
            <text wx:if="{{item.status === 'available'}}" class="btn-rent">ç«‹å³ç§Ÿç”¨</text>
            <text wx:else class="btn-disabled">ä¸å¯ç§Ÿç”¨</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{!loading && gardens.length === 0}}" class="empty-state">
    <image src="/images/empty.png"></image>
    <text>æš‚æ— èœåœ°æ•°æ®</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{hasMore && !loading}}" class="load-more" bindtap="loadMore">
    <text>åŠ è½½æ›´å¤š</text>
  </view>

  <view wx:if="{{!hasMore && gardens.length > 0}}" class="no-more">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>
