<!--pages/post-detail/post-detail.wxml-->
<view class="container post-detail-page">
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:if="{{!loading && post}}" class="detail-content">
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="author-section">
      <image src="{{post.user_avatar || '/images/default-avatar.png'}}" class="author-avatar"></image>
      <view class="author-info">
        <text class="author-name">{{post.user_nickname || 'åŒ¿åç”¨æˆ·'}}</text>
        <text class="post-time">{{post.created_at}}</text>
      </view>
      <button wx:if="{{post.is_author}}" class="delete-btn" bindtap="handleDelete">
        åˆ é™¤
      </button>
    </view>

    <!-- å¸–å­å†…å®¹ -->
    <view class="content-section">
      <view class="post-title" wx:if="{{post.title}}">{{post.title}}</view>
      <view class="post-content">{{post.content}}</view>

      <!-- å›¾ç‰‡å±•ç¤º -->
      <view class="post-images" wx:if="{{post.images && post.images.length > 0}}">
        <image
          wx:for="{{post.images}}"
          wx:key="index"
          src="{{item}}"
          mode="widthFix"
          class="post-image"
          bindtap="previewImage"
          data-urls="{{post.images}}"
          data-current="{{item}}"
        ></image>
      </view>
    </view>

    <!-- äº’åŠ¨ç»Ÿè®¡ -->
    <view class="stats-section">
      <view class="stat-item">
        <text class="stat-icon">â¤ï¸</text>
        <text class="stat-text">{{post.like_count || 0}} ç‚¹èµ</text>
      </view>
      <view class="stat-item">
        <text class="stat-icon">ğŸ’¬</text>
        <text class="stat-text">{{post.comment_count || 0}} è¯„è®º</text>
      </view>
      <view class="stat-item">
        <text class="stat-icon">ğŸ‘ï¸</text>
        <text class="stat-text">{{post.view_count || 0}} æµè§ˆ</text>
      </view>
    </view>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view class="comments-section">
      <view class="section-header">
        <text class="section-title">å…¨éƒ¨è¯„è®º {{comments.length}}</text>
      </view>

      <view wx:if="{{comments.length > 0}}" class="comment-list">
        <view wx:for="{{comments}}" wx:key="id" class="comment-item">
          <image src="{{item.user_avatar || '/images/default-avatar.png'}}" class="comment-avatar"></image>
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-user">{{item.user_nickname || 'åŒ¿å'}}</text>
              <text class="comment-time">{{item.created_at}}</text>
            </view>
            <view class="comment-text">{{item.content}}</view>
          </view>
        </view>
      </view>

      <view wx:else class="empty-comments">
        <text>æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘~</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar" wx:if="{{!loading && post}}">
    <view class="comment-input-wrapper">
      <input
        class="comment-input"
        type="text"
        placeholder="è¯´ç‚¹ä»€ä¹ˆ..."
        value="{{commentInput}}"
        bindinput="onCommentInput"
        confirm-type="send"
        bindconfirm="sendComment"
      />
    </view>

    <view class="action-buttons">
      <view
        class="action-btn {{post.liked ? 'liked' : ''}}"
        bindtap="handleLike"
      >
        <text class="btn-icon">{{post.liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="btn-text">{{post.like_count || 0}}</text>
      </view>

      <button class="send-btn" bindtap="sendComment" disabled="{{submitting}}">
        {{submitting ? 'å‘é€ä¸­...' : 'å‘é€'}}
      </button>
    </view>
  </view>
</view>