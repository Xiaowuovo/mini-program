<!--pages/my-gardens/my-gardens.wxml-->
<view class="container my-gardens-page">
  <!-- çŠ¶æ€æ ‡ç­¾æ  -->
  <view class="status-tabs">
    <scroll-view class="tabs-scroll" scroll-x>
      <view class="tabs-wrapper">
        <view
          wx:for="{{statusTabs}}"
          wx:key="key"
          class="tab-item {{currentStatus === item.key ? 'active' : ''}}"
          bindtap="onTabChange"
          data-status="{{item.key}}"
        >
          {{item.label}}
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- èœåœ°åˆ—è¡¨ -->
  <view class="garden-list">
    <view
      wx:for="{{gardens}}"
      wx:key="id"
      class="garden-card {{item.current_order.is_active ? 'active' : 'expired'}}"
    >
      <!-- èœåœ°å›¾ç‰‡å’ŒåŸºæœ¬ä¿¡æ¯ -->
      <view class="garden-header" bindtap="viewGardenDetail" data-id="{{item.id}}">
        <image
          src="{{item.images && item.images.length > 0 ? item.images[0] : '/images/default-garden.png'}}"
          class="garden-image"
          mode="aspectFill"
        ></image>
        <view class="garden-info">
          <view class="garden-name-row">
            <text class="garden-name">{{item.name}}</text>
            <view class="status-badge {{item.current_order.is_active ? 'active' : 'expired'}}">
              {{item.current_order.is_active ? 'ä½¿ç”¨ä¸­' : 'å·²è¿‡æœŸ'}}
            </view>
          </view>
          <view class="garden-spec">
            <text class="spec-item">ğŸ“ {{item.area}}ã¡</text>
            <text class="spec-item">ğŸ“ {{item.location || 'æš‚æ— ä½ç½®'}}</text>
          </view>
        </view>
      </view>

      <!-- ç§ŸæœŸä¿¡æ¯ -->
      <view class="rental-info">
        <view class="info-row">
          <text class="info-label">ç§ŸæœŸ</text>
          <text class="info-value">{{item.current_order.start_date}} è‡³ {{item.current_order.end_date}}</text>
        </view>
        <view class="info-row" wx:if="{{item.current_order.is_active}}">
          <text class="info-label">å‰©ä½™</text>
          <text class="info-value highlight">{{item.current_order.remaining_days}} å¤©</text>
        </view>
        <view class="info-row" wx:else>
          <text class="info-label">çŠ¶æ€</text>
          <text class="info-value expired-text">ç§ŸæœŸå·²ç»“æŸ</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="garden-actions">
        <view class="action-btn secondary" bindtap="viewOrderDetail" data-id="{{item.id}}">
          è®¢å•è¯¦æƒ…
        </view>
        <view wx:if="{{item.current_order.is_active}}" class="action-btn secondary" bindtap="addPlanting" data-id="{{item.id}}" data-name="{{item.name}}">
          æ·»åŠ ä½œç‰©
        </view>
        <view wx:if="{{item.current_order.is_active && item.video_stream_url}}" class="action-btn secondary" bindtap="viewMonitor" data-id="{{item.id}}">
          è§†é¢‘ç›‘æ§
        </view>
        <view class="action-btn primary" bindtap="{{item.current_order.is_active ? 'viewGardenDetail' : 'renewGarden'}}" data-id="{{item.id}}">
          {{item.current_order.is_active ? 'æŸ¥çœ‹è¯¦æƒ…' : 'ç»­ç§Ÿèœåœ°'}}
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{!loading && gardens.length === 0}}" class="empty-state">
    <image src="/images/empty.png" class="empty-image"></image>
    <text class="empty-text">è¿˜æ²¡æœ‰èœåœ°å“¦</text>
    <navigator url="/pages/gardens/gardens" class="go-rent-btn">
      å»ç§Ÿèœåœ°
    </navigator>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{hasMore && !loading && gardens.length > 0}}" class="load-more">
    <text>åŠ è½½æ›´å¤š...</text>
  </view>

  <view wx:if="{{!hasMore && gardens.length > 0}}" class="no-more">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>
