<!--pages/services/services.wxml-->
<view class="container services-page">
  <!-- 服务统计 -->
  <view class="stats-row">
    <view class="stat-item">
      <text class="stat-value">{{stats.totalServices}}</text>
      <text class="stat-label">服务种类</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value">{{stats.totalOrders}}</text>
      <text class="stat-label">服务订单</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value">{{stats.satisfaction}}%</text>
      <text class="stat-label">满意度</text>
    </view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-section">
    <view class="search-bar">
      <view class="search-icon">🔍</view>
      <input
        class="search-input"
        placeholder="搜索服务名称或描述"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
      <view wx:if="{{searchKeyword}}" class="clear-icon" bindtap="clearSearch">✕</view>
    </view>
    <view class="sort-btn" bindtap="toggleSortMenu">
      <text class="sort-icon">⇅</text>
      <text class="sort-text">排序</text>
    </view>
  </view>

  <!-- 排序菜单 -->
  <view wx:if="{{showSortMenu}}" class="sort-menu-mask" bindtap="toggleSortMenu">
    <view class="sort-menu" catchtap="stopPropagation">
      <view class="sort-header">
        <text class="sort-title">选择排序方式</text>
        <view class="close-btn" bindtap="toggleSortMenu">✕</view>
      </view>
      <view class="sort-options">
        <view
          class="sort-option {{sortType === 'default' ? 'active' : ''}}"
          bindtap="selectSort"
          data-type="default"
        >
          <text>默认排序</text>
          <text wx:if="{{sortType === 'default'}}" class="check-icon">✓</text>
        </view>
        <view
          class="sort-option {{sortType === 'price_asc' ? 'active' : ''}}"
          bindtap="selectSort"
          data-type="price_asc"
        >
          <text>价格从低到高</text>
          <text wx:if="{{sortType === 'price_asc'}}" class="check-icon">✓</text>
        </view>
        <view
          class="sort-option {{sortType === 'price_desc' ? 'active' : ''}}"
          bindtap="selectSort"
          data-type="price_desc"
        >
          <text>价格从高到低</text>
          <text wx:if="{{sortType === 'price_desc'}}" class="check-icon">✓</text>
        </view>
        <view
          class="sort-option {{sortType === 'popular' ? 'active' : ''}}"
          bindtap="selectSort"
          data-type="popular"
        >
          <text>热门优先</text>
          <text wx:if="{{sortType === 'popular'}}" class="check-icon">✓</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 分类标签 -->
  <view class="category-section">
    <scroll-view class="tabs-scroll" scroll-x show-scrollbar="{{false}}">
      <view class="tabs-wrapper">
        <view
          wx:for="{{categories}}"
          wx:key="id"
          class="tab-item {{currentCategory === item.id ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-category="{{item.id}}"
        >
          <text class="tab-icon">{{item.icon}}</text>
          <text class="tab-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 结果统计 -->
  <view wx:if="{{!loading && filteredServices.length > 0}}" class="result-count">
    <text class="count-text">找到 {{filteredServices.length}} 个服务</text>
  </view>

  <!-- 服务列表 -->
  <view class="service-list">
    <view
      wx:for="{{filteredServices}}"
      wx:key="id"
      class="service-card"
      bindtap="viewServiceDetail"
      data-id="{{item.id}}"
    >
      <!-- 服务头部 -->
      <view class="service-header">
        <view class="service-icon-wrapper">
          <text class="service-icon">{{item.icon}}</text>
        </view>
        <view class="service-info">
          <view class="service-name-row">
            <text class="service-name">{{item.name}}</text>
            <view wx:if="{{item.isPopular}}" class="popular-badge">热门</view>
          </view>
          <text class="service-desc">{{item.description}}</text>
          <view class="service-meta">
            <view class="rating-box">
              <text class="star-icon">⭐</text>
              <text class="rating-text">{{item.rating || '5.0'}}</text>
            </view>
            <text class="order-count">已售 {{item.orderCount || 0}}</text>
          </view>
        </view>
        <view class="favorite-btn" catchtap="toggleFavorite" data-id="{{item.id}}">
          <text class="favorite-icon {{item.isFavorite ? 'active' : ''}}">{{item.isFavorite ? '❤️' : '🤍'}}</text>
        </view>
      </view>

      <!-- 特色标签 -->
      <view class="features-list" wx:if="{{item.features && item.features.length > 0}}">
        <view wx:for="{{item.features}}" wx:key="index" wx:for-item="feature" class="feature-tag">
          <text class="feature-icon">✓</text>
          <text>{{feature}}</text>
        </view>
      </view>

      <!-- 服务详情 -->
      <view class="service-details">
        <view class="detail-item">
          <text class="detail-label">服务时长</text>
          <text class="detail-value">{{item.duration || '30分钟'}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">服务人员</text>
          <text class="detail-value">专业团队</text>
        </view>
      </view>

      <!-- 底部操作 -->
      <view class="service-footer">
        <view class="service-price">
          <text class="price-symbol">¥</text>
          <text class="price-number">{{item.price}}</text>
          <text class="price-unit">/{{item.unit}}</text>
        </view>
        <button
          class="book-btn"
          bindtap="bookService"
          data-id="{{item.id}}"
          catch:tap="bookService"
        >
          立即预约
        </button>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-state">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 空状态 -->
  <view wx:if="{{!loading && filteredServices.length === 0}}" class="empty-state">
    <text class="empty-icon">🌱</text>
    <text class="empty-text">{{searchKeyword ? '没有找到相关服务' : '暂无服务'}}</text>
    <text class="empty-hint">{{searchKeyword ? '试试其他关键词' : '点击下方按钮刷新'}}</text>
    <button class="refresh-btn" bindtap="loadServices">
      <text class="refresh-icon">🔄</text>
      <text>刷新数据</text>
    </button>
  </view>

  <!-- 快捷入口 -->
  <view wx:if="{{!loading && filteredServices.length > 0}}" class="quick-actions">
    <view class="action-item" bindtap="viewAllOrders">
      <view class="action-icon-wrapper action-green">
        <text class="action-icon">📋</text>
      </view>
      <text class="action-text">我的订单</text>
    </view>
    <view class="action-item" bindtap="contactService">
      <view class="action-icon-wrapper action-blue">
        <text class="action-icon">💬</text>
      </view>
      <text class="action-text">联系客服</text>
    </view>
  </view>

  <!-- 服务说明 -->
  <view class="tips-section">
    <view class="tips-header">
      <text class="tips-icon">💡</text>
      <text class="tips-title">服务说明</text>
    </view>
    <view class="tips-content">
      <view class="tip-item">
        <text class="tip-dot">•</text>
        <text class="tip-text">所有服务由经验丰富的专业人员提供</text>
      </view>
      <view class="tip-item">
        <text class="tip-dot">•</text>
        <text class="tip-text">服务时间灵活，可根据您的需求预约</text>
      </view>
      <view class="tip-item">
        <text class="tip-dot">•</text>
        <text class="tip-text">支持在线支付和现场支付两种方式</text>
      </view>
      <view class="tip-item">
        <text class="tip-dot">•</text>
        <text class="tip-text">服务完成后可进行评价，帮助我们改进</text>
      </view>
      <view class="tip-item">
        <text class="tip-dot">•</text>
        <text class="tip-text">如有问题请联系客服：400-123-4567</text>
      </view>
    </view>
  </view>

  <!-- 底部安全区 -->
  <view class="safe-bottom"></view>
</view>
