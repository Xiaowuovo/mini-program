<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ¬¢è¿æ  -->
  <view class="welcome-bar">
    <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
    <view class="custom-navbar">
      <text class="navbar-title">äº‘ç«¯å°ç­‘</text>
    </view>

    <!-- æ¬¢è¿å†…å®¹ -->
    <view class="welcome-content">
      <view class="welcome-text">
        <text class="greeting">{{greeting}}ï¼Œ</text>
        <text class="user-name">{{userName}}</text>
      </view>
      <view class="weather-info" wx:if="{{weather}}">
        <text class="weather-icon">{{weather.icon}}</text>
        <text class="weather-text">{{weather.temp}}Â°C</text>
      </view>
    </view>
  </view>

  <!-- è½®æ’­å›¾ -->
  <swiper
    class="banner-swiper"
    indicator-dots="{{false}}"
    autoplay
    circular
    interval="{{5000}}"
    duration="{{500}}"
    bindchange="onBannerChange"
  >
    <swiper-item wx:for="{{banners}}" wx:key="id">
      <view class="banner-item">
        <image src="{{item.image}}" class="banner-image" mode="aspectFill" binderror="onBannerError" data-index="{{index}}"></image>
        <view class="banner-overlay">
          <view class="banner-title">{{item.title}}</view>
          <view class="banner-desc">{{item.desc}}</view>
        </view>
      </view>
    </swiper-item>
  </swiper>
  <!-- è‡ªå®šä¹‰æŒ‡ç¤ºå™¨ -->
  <view class="custom-indicator">
    <view
      wx:for="{{banners}}"
      wx:key="id"
      class="indicator-dot {{currentBanner === index ? 'active' : ''}}"
    ></view>
  </view>

  <!-- å¿«æ·å…¥å£ -->
  <view class="quick-actions">
    <view class="function-grid">
      <view class="function-item" bindtap="navigateToGardens">
        <view class="function-icon-wrapper bg-green">
          <text class="function-emoji">ğŸŒ±</text>
        </view>
        <text class="function-label">ç§Ÿç”¨èœåœ°</text>
        <view class="function-badge" wx:if="{{availableCount > 0}}">{{availableCount}}</view>
      </view>
      <view class="function-item" bindtap="navigateToMyGardens">
        <view class="function-icon-wrapper bg-blue">
          <text class="function-emoji">ğŸ¡</text>
        </view>
        <text class="function-label">æˆ‘çš„èœåœ°</text>
        <view class="function-badge red" wx:if="{{myGardenCount > 0}}">{{myGardenCount}}</view>
      </view>
      <view class="function-item" bindtap="navigateToServices">
        <view class="function-icon-wrapper bg-orange">
          <text class="function-emoji">ğŸ›ï¸</text>
        </view>
        <text class="function-label">å¢å€¼æœåŠ¡</text>
      </view>
      <view class="function-item" bindtap="navigateToReminders">
        <view class="function-icon-wrapper bg-purple">
          <text class="function-emoji">â°</text>
        </view>
        <text class="function-label">ä»»åŠ¡æé†’</text>
        <view class="function-badge red" wx:if="{{pendingTasks > 0}}">{{pendingTasks}}</view>
      </view>
    </view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="stat-item">
      <view class="stat-icon">ğŸ“Š</view>
      <view class="stat-info">
        <view class="stat-value">{{totalGardens}}</view>
        <view class="stat-label">èœåœ°æ€»æ•°</view>
      </view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <view class="stat-icon">ğŸ‘¥</view>
      <view class="stat-info">
        <view class="stat-value">{{totalUsers}}</view>
        <view class="stat-label">ç”¨æˆ·æ€»æ•°</view>
      </view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <view class="stat-icon">âœ¨</view>
      <view class="stat-info">
        <view class="stat-value">{{satisfactionRate}}%</view>
        <view class="stat-label">æ»¡æ„åº¦</view>
      </view>
    </view>
  </view>

  <!-- çƒ­é—¨èœåœ° -->
  <view class="section">
    <view class="section-header">
      <view class="section-title-wrapper">
        <text class="section-icon">ğŸ”¥</text>
        <text class="section-title">çƒ­é—¨èœåœ°</text>
      </view>
      <view class="section-more" bindtap="navigateToGardens">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="arrow">â†’</text>
      </view>
    </view>

    <!-- æ¨ªå‘æ»šåŠ¨èœåœ°åˆ—è¡¨ -->
    <scroll-view class="garden-scroll" scroll-x show-scrollbar="{{false}}">
      <view class="garden-list-horizontal">
        <view
          wx:for="{{hotGardens}}"
          wx:key="id"
          class="garden-card-h"
          bindtap="navigateToGardenDetail"
          data-id="{{item.id}}"
        >
          <image
            src="{{item.image_url || (item.images && item.images.length > 0 ? item.images[0] : '/images/default-garden.png')}}"
            class="garden-image-h"
            mode="aspectFill"
            binderror="onGardenImageError"
            data-index="{{index}}"
          ></image>
          <view class="garden-overlay">
            <view class="garden-status-tag status-{{item.status}}">
              {{item.status === 'available' ? 'å¯ç§Ÿç”¨' : item.status === 'rented' ? 'å·²ç§Ÿå‡º' : 'ç»´æŠ¤ä¸­'}}
            </view>
          </view>
          <view class="garden-info-h">
            <view class="garden-name-h">{{item.name}}</view>
            <view class="garden-meta">
              <text class="meta-item">ğŸ“ {{item.area}}ã¡</text>
              <text class="meta-item">ğŸ“ {{item.location}}</text>
            </view>
            <view class="garden-footer-h">
              <view class="garden-price-h">
                <text class="price-symbol">Â¥</text>
                <text class="price-number">{{item.price}}</text>
                <text class="price-unit">/æœˆ</text>
              </view>
              <view class="rent-btn">ç«‹å³ç§Ÿç”¨</view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <view wx:if="{{hotGardens.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸŒ¾</text>
      <text class="empty-text">æš‚æ— çƒ­é—¨èœåœ°</text>
      <view class="empty-btn" bindtap="loadHotGardens">åˆ·æ–°è¯•è¯•</view>
    </view>
  </view>

  <!-- ç§æ¤çŸ¥è¯† -->
  <view class="section">
    <view class="section-header">
      <view class="section-title-wrapper">
        <text class="section-icon">ğŸ“š</text>
        <text class="section-title">ç§æ¤çŸ¥è¯†</text>
      </view>
      <view class="section-more" bindtap="navigateToKnowledge">
        <text>å­¦ä¹ æ›´å¤š</text>
        <text class="arrow">â†’</text>
      </view>
    </view>

    <view class="knowledge-grid">
      <view
        wx:for="{{knowledgeList}}"
        wx:key="id"
        class="knowledge-card"
        bindtap="viewKnowledge"
        data-id="{{item.id}}"
      >
        <view class="knowledge-icon">{{item.icon}}</view>
        <view class="knowledge-title">{{item.title}}</view>
        <view class="knowledge-desc">{{item.desc}}</view>
      </view>
    </view>
  </view>

  <!-- æœ€æ–°åŠ¨æ€ -->
  <view class="section">
    <view class="section-header">
      <view class="section-title-wrapper">
        <text class="section-icon">ğŸ’¬</text>
        <text class="section-title">ç¤¾åŒºåŠ¨æ€</text>
      </view>
      <view class="section-more" bindtap="navigateToCommunity">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="arrow">â†’</text>
      </view>
    </view>

    <view class="post-list">
      <view
        wx:for="{{latestPosts}}"
        wx:key="id"
        class="post-card"
        bindtap="navigateToPostDetail"
        data-id="{{item.id}}"
      >
        <view class="post-header">
          <image src="{{item.user_avatar || '/images/default-avatar.png'}}" class="user-avatar"></image>
          <view class="post-user">
            <view class="user-name">{{item.user_nickname}}</view>
            <view class="post-time">{{item.created_at}}</view>
          </view>
        </view>
        <view class="post-content">
          <view class="post-title">{{item.title}}</view>
          <view class="post-text">{{item.content}}</view>
        </view>
        <view class="post-footer">
          <view class="post-stat">
            <text class="stat-icon">ğŸ’¬</text>
            <text>{{item.comment_count || 0}}</text>
          </view>
          <view class="post-stat">
            <text class="stat-icon">â¤ï¸</text>
            <text>{{item.like_count || 0}}</text>
          </view>
        </view>
      </view>
    </view>

    <view wx:if="{{latestPosts.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ’­</text>
      <text class="empty-text">è¿˜æ²¡æœ‰åŠ¨æ€ï¼Œå¿«å»å‘å¸ƒç¬¬ä¸€æ¡å§ï¼</text>
      <view class="empty-btn" bindtap="navigateToCommunity">å»å‘å¸ƒ</view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒº -->
  <view class="safe-bottom"></view>
</view>
