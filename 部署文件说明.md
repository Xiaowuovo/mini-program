# 📋 部署相关文件说明

## 🎯 目的

本文档说明项目中所有与部署相关的文件，帮助你快速了解每个文件的作用。

---

## 📂 文件清单

### 根目录

| 文件名 | 类型 | 作用 | 重要性 |
|--------|------|------|--------|
| `DEPLOYMENT.md` | 文档 | **完整的部署指南**，包含详细的步骤和说明 | ⭐⭐⭐⭐⭐ |
| `新机器部署指南.md` | 文档 | **快速部署手册**，10分钟快速上手 | ⭐⭐⭐⭐⭐ |
| `README.md` | 文档 | 项目总体介绍 | ⭐⭐⭐⭐ |
| `TROUBLESHOOTING.md` | 文档 | 故障排查指南 | ⭐⭐⭐⭐ |
| `启动项目.bat` | 脚本 | Windows一键启动脚本 | ⭐⭐⭐⭐ |
| `停止项目.bat` | 脚本 | Windows一键停止脚本 | ⭐⭐⭐ |

### backend/ 目录

| 文件名 | 类型 | 作用 | 重要性 |
|--------|------|------|--------|
| `init_database.sql` | SQL | **数据库初始化脚本**，创建所有表和测试数据 | ⭐⭐⭐⭐⭐ |
| `init_db.bat` | 脚本 | **Windows数据库初始化脚本** | ⭐⭐⭐⭐⭐ |
| `init_db.sh` | 脚本 | **Linux/Mac数据库初始化脚本** | ⭐⭐⭐⭐⭐ |
| `数据库初始化说明.md` | 文档 | 数据库初始化详细说明 | ⭐⭐⭐⭐ |
| `.env.example` | 配置 | 环境变量配置模板 | ⭐⭐⭐⭐⭐ |
| `.env` | 配置 | 实际环境配置（需要创建） | ⭐⭐⭐⭐⭐ |
| `requirements.txt` | 依赖 | Python依赖包列表 | ⭐⭐⭐⭐⭐ |
| `run.bat` | 脚本 | Windows后端启动脚本 | ⭐⭐⭐⭐ |
| `start.sh` | 脚本 | Linux/Mac后端启动脚本 | ⭐⭐⭐⭐ |
| `README.md` | 文档 | 后端项目说明 | ⭐⭐⭐ |

### miniprogram/ 目录

| 文件名 | 类型 | 作用 | 重要性 |
|--------|------|------|--------|
| `app.js` | 代码 | 小程序入口文件 | ⭐⭐⭐⭐⭐ |
| `app.json` | 配置 | 小程序全局配置 | ⭐⭐⭐⭐⭐ |
| `project.config.json` | 配置 | 开发者工具配置 | ⭐⭐⭐⭐ |
| `utils/request.js` | 代码 | API请求封装（需配置BASE_URL） | ⭐⭐⭐⭐⭐ |
| `README.md` | 文档 | 小程序说明 | ⭐⭐⭐ |

---

## 🚀 新机器部署使用流程

### 第一次部署（推荐阅读顺序）

1. **首先阅读**: `新机器部署指南.md` - 获得快速概览
2. **准备环境**: 安装 Python、MySQL、Git、微信开发者工具
3. **克隆项目**: 使用Git克隆项目到本地
4. **初始化数据库**:
   - Windows: 运行 `backend/init_db.bat`
   - Linux/Mac: 运行 `backend/init_db.sh`
5. **配置环境**:
   - 复制 `backend/.env.example` 为 `backend/.env`
   - 修改数据库密码、微信配置等
6. **安装依赖**: 运行 `pip install -r requirements.txt`
7. **启动后端**:
   - Windows: 运行 `backend/run.bat`
   - Linux/Mac: 运行 `backend/start.sh`
8. **启动小程序**: 微信开发者工具导入 `miniprogram` 目录

### 如遇问题

1. **查看**: `TROUBLESHOOTING.md` - 常见问题解决方案
2. **详细参考**: `DEPLOYMENT.md` - 完整的部署文档
3. **数据库问题**: `backend/数据库初始化说明.md`

---

## 📝 文件用途详解

### 1. 数据库初始化文件

#### `init_database.sql`
- **作用**: 完整的SQL脚本
- **内容**:
  - 创建 garden_db 数据库
  - 创建14张数据表
  - 插入测试数据
- **使用场景**:
  - 新机器首次部署
  - 需要重置数据库时
  - 手动执行SQL

#### `init_db.bat` / `init_db.sh`
- **作用**: 一键运行SQL脚本
- **优点**:
  - 自动化执行
  - 交互式输入密码
  - 显示执行结果
  - 错误提示
- **使用场景**: 快速初始化（推荐）

### 2. 环境配置文件

#### `.env.example`
- **作用**: 环境变量配置模板
- **包含**:
  - 数据库配置示例
  - 微信小程序配置示例
  - 安全配置示例
- **使用**: 复制为 `.env` 后修改

#### `.env`（需创建）
- **作用**: 实际的环境配置
- **重要**:
  - ⚠️ 包含敏感信息
  - ⚠️ 不要提交到Git
  - ⚠️ 每个环境都不同

### 3. 启动脚本

#### Windows脚本
- `启动项目.bat` - 同时启动后端和提示小程序启动
- `backend/run.bat` - 仅启动后端
- `停止项目.bat` - 停止所有服务

#### Linux/Mac脚本
- `backend/start.sh` - 启动后端服务

### 4. 依赖文件

#### `requirements.txt`
- **作用**: Python依赖包清单
- **包含**: FastAPI、SQLAlchemy、MySQL驱动等
- **使用**: `pip install -r requirements.txt`

---

## 🔧 典型使用场景

### 场景1: 全新机器部署

```bash
# 1. 克隆项目
git clone <repo-url>
cd garden-miniprogram

# 2. 初始化数据库
cd backend
init_db.bat  # Windows
# 或
./init_db.sh  # Linux/Mac

# 3. 配置环境
copy .env.example .env  # 修改配置

# 4. 安装依赖
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt

# 5. 启动服务
run.bat  # Windows
# 或
./start.sh  # Linux/Mac
```

### 场景2: 重置数据库

```bash
# 删除旧数据库
mysql -u root -p
DROP DATABASE garden_db;
EXIT;

# 重新初始化
cd backend
init_db.bat  # Windows
./init_db.sh  # Linux/Mac
```

### 场景3: 更新依赖

```bash
# 拉取最新代码
git pull

# 更新Python依赖
pip install -r requirements.txt --upgrade

# 重启服务
```

### 场景4: 迁移到生产环境

1. 阅读 `DEPLOYMENT.md` 的"生产环境部署"章节
2. 修改 `.env` 配置（关闭DEBUG、使用HTTPS等）
3. 配置Nginx反向代理
4. 使用PM2管理进程
5. 配置小程序合法域名

---

## ⚠️ 重要注意事项

### 敏感文件保护

**不要提交到Git:**
- ❌ `backend/.env`
- ❌ `backend/venv/`
- ❌ `backend/__pycache__/`
- ❌ `miniprogram/project.private.config.json`

**已在.gitignore中配置**，但请确认:
```bash
# 检查.gitignore
cat .gitignore

# 应包含:
# .env
# venv/
# __pycache__/
# *.pyc
```

### 数据库安全

1. **修改默认密码**: 不要使用 `123456`
2. **限制远程访问**: 生产环境仅允许本地连接
3. **定期备份**: 使用 `mysqldump` 备份数据

### 小程序配置

1. **开发环境**: 可以勾选"不校验合法域名"
2. **生产环境**: 必须配置合法域名并上传HTTPS证书
3. **AppID和Secret**: 从微信公众平台获取，不要泄露

---

## 📊 文件依赖关系

```
新机器部署指南.md
    ↓
DEPLOYMENT.md (详细文档)
    ↓
backend/
    ├── init_db.bat/sh (执行)
    │   ↓
    ├── init_database.sql (被执行)
    ├── .env.example (模板)
    │   ↓
    ├── .env (实际配置)
    ├── requirements.txt (依赖)
    └── run.bat/start.sh (启动)
```

---

## 🎯 快速参考

| 我想... | 应该使用... |
|---------|------------|
| 快速了解部署流程 | `新机器部署指南.md` |
| 详细的部署步骤 | `DEPLOYMENT.md` |
| 初始化数据库 | `backend/init_db.bat` 或 `init_db.sh` |
| 了解数据库结构 | `backend/数据库初始化说明.md` |
| 配置环境变量 | `backend/.env.example` → `.env` |
| 启动后端服务 | `backend/run.bat` 或 `start.sh` |
| 解决问题 | `TROUBLESHOOTING.md` |
| 了解项目整体 | `README.md` |

---

## 📞 获取帮助

如果遇到问题:

1. **首先查看**: `TROUBLESHOOTING.md`
2. **数据库问题**: `backend/数据库初始化说明.md`
3. **详细步骤**: `DEPLOYMENT.md`
4. **检查日志**: `backend/logs/` 目录

---

**文档版本**: v1.0.0
**最后更新**: 2024-12-10
**维护**: 云端小筑团队
